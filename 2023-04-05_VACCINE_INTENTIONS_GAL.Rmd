---
title: "2023-04-05_COVERED_VACCINE_INTENTIONS"
author: "Arianne Albert, PhD - later edited by Gal Av-Gay"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document: default
  pdf_document: default
---
Copied by I Folkes, further edits by Gal Av-Gay

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, include = TRUE)

library(lme4)
library(MASS)
library(multcomp)
library(Gmisc)
library(RColorBrewer)
library(lubridate)
# install.packages("Hmisc")
library(Hmisc)
library(broman)
library(dplyr)
library(ggplot2)
library(mgcv)
library(effects)
library(here)
library(tidyverse)
library(margins)
# install.packages("emmeans")
# install.packages("sjPlot")
library(sjPlot)
library(sjPlot)
library(rcompanion)
library(ggpubr)
library(ggeffects)
library(survey)
library(knitr)
library(lmerTest)
library(emmeans)
library(quantreg)
library(zoo)
library(sjstats)
library(kableExtra)
library(geepack)
library(viridis)
library(chron)
library(ghibli)
library(psych)
library(ltm)


theme_set(
  theme(text = element_text(size = 14))
)

directory <- ("./Downloads/")
```

```{r data, include = F}
data <- read.csv("/Users/mac/Desktop/RID/covered/suraya_ianna/MainSurveyDatabaseCa-VaccineAttitudesIF_DATA_2022-08-12_0937.csv", stringsAsFactors = TRUE, strip.white = TRUE)
```

```{r data cleaning and inclusion, include = F}
# exclude the non living in Canada
describeFactors(data$redcap_event_name)
# describeFactors(data$covered_econsent_complete)
describeFactors(data$bl16_country_res)
describeFactors(data$bl16_country_res[which(data$redcap_event_name == "baseline_arm_1")])

describeFactors(data$bl16_country_res[which(data$withdraw_answer == 1)])

data <- data[-which(data$withdraw_answer == 1), ]

ids.can <- data$record_id[which(data$bl16_country_res == 1)]

length(unique(data$record_id))

data_bl <- data[which(data$redcap_event_name == "baseline_arm_1" & data$record_id %in% ids.can), ]
data_2mo <- data[which(data$redcap_event_name == "followup_2_months_arm_1" & data$record_id %in% ids.can), ]
data_4mo <- data[which(data$redcap_event_name == "followup_4_months_arm_1" & data$record_id %in% ids.can), ]
data_6mo <- data[which(data$redcap_event_name == "followup_6_months_arm_1" & data$record_id %in% ids.can), ]
data_8mo <- data[which(data$redcap_event_name == "followup_8_months_arm_1" & data$record_id %in% ids.can), ]
data_10mo <- data[which(data$redcap_event_name == "followup_10_months_arm_1" & data$record_id %in% ids.can), ]
data_14mo <- data[which(data$redcap_event_name == "followup_14_months_arm_1" & data$record_id %in% ids.can), ]

# followup_10_months_arm_1 "3,522"
# followup_14_months_arm_1 "411"   
# followup_2_months_arm_1  "4,992"
# followup_4_months_arm_1  "4,725"
# followup_6_months_arm_1  "4,399"
# followup_8_months_arm_1  "3,975"

## clear out empty rows and columns
### some columns are entirely "" rather than NA
data_bl <- data_bl %>% 
  mutate(across(where(is.factor), ~as.character(.x))) %>% 
  mutate(across(where(is.character), ~ifelse(.x == "", NA_character_, .)))
  
data_2mo <- data_2mo %>% 
  mutate(across(where(is.factor), ~as.character(.x))) %>% 
  mutate(across(where(is.character), ~ifelse(.x == "", NA_character_, .)))

data_4mo <- data_4mo %>% 
  mutate(across(where(is.factor), ~as.character(.x))) %>% 
  mutate(across(where(is.character), ~ifelse(.x == "", NA_character_, .)))

data_6mo <- data_6mo %>% 
  mutate(across(where(is.factor), ~as.character(.x))) %>% 
  mutate(across(where(is.character), ~ifelse(.x == "", NA_character_, .)))

data_8mo <- data_8mo %>% 
  mutate(across(where(is.factor), ~as.character(.x))) %>% 
  mutate(across(where(is.character), ~ifelse(.x == "", NA_character_, .)))

data_10mo <- data_10mo %>% 
  mutate(across(where(is.factor), ~as.character(.x))) %>% 
  mutate(across(where(is.character), ~ifelse(.x == "", NA_character_, .)))

data_14mo <- data_14mo %>% 
  mutate(across(where(is.factor), ~as.character(.x))) %>% 
  mutate(across(where(is.character), ~ifelse(.x == "", NA_character_, .)))

data_bl <- janitor::remove_empty(data_bl)
data_2mo <- janitor::remove_empty(data_2mo)
data_4mo <- janitor::remove_empty(data_4mo)
data_6mo <- janitor::remove_empty(data_6mo)
data_8mo <- janitor::remove_empty(data_8mo)
data_10mo <- janitor::remove_empty(data_10mo)
data_14mo <- janitor::remove_empty(data_14mo)

# find variable names in common
colnames(data_bl) <- paste0(colnames(data_bl), "_BL")
colnames(data_2mo) <- paste0(colnames(data_2mo), "_2mo")
colnames(data_4mo) <- paste0(colnames(data_4mo), "_4mo")
colnames(data_6mo) <- paste0(colnames(data_6mo), "_6mo")
colnames(data_8mo) <- paste0(colnames(data_8mo), "_8mo")
colnames(data_10mo) <- paste0(colnames(data_10mo), "_10mo")
colnames(data_14mo) <- paste0(colnames(data_14mo), "_14mo")

data_bl$record_id <- data_bl$record_id_BL
data_2mo$record_id <- data_2mo$record_id_2mo
data_4mo$record_id <- data_4mo$record_id_4mo
data_6mo$record_id <- data_6mo$record_id_6mo
data_8mo$record_id <- data_8mo$record_id_8mo
data_10mo$record_id <- data_10mo$record_id_10mo
data_14mo$record_id <- data_14mo$record_id_14mo


data_use <- left_join(data_bl, data_2mo, by = "record_id")
data_use <- left_join(data_use, data_4mo, by = "record_id")
data_use <- left_join(data_use, data_6mo, by = "record_id")
data_use <- left_join(data_use, data_8mo, by = "record_id")
data_use <- left_join(data_use, data_10mo, by = "record_id")
data_use <- left_join(data_use, data_14mo, by = "record_id")

data <- data_use

```

```{r pull out vaccine attitudes surveys, include = F}
length(which(is.na(data$vaccine_attitudes_survey_timestamp_BL)))
# 2304 do not have vaccine attitudes survey
length(which(is.na(data$v1_dose1_likely_BL)))

data <- data[-which(is.na(data$vaccine_attitudes_survey_timestamp_BL)), ]
data <- data[-which(is.na(data$v1_dose1_likely_BL)),]

# describeFactors(data$v1_dose1_likely_BL)

data <- data %>%
  mutate(
    likely_full = case_when(
      v1_dose1_likely_BL == 1 ~ "Very Unlikely",
      v1_dose1_likely_BL == 2 ~ "Unlikely",
      v1_dose1_likely_BL == 3 ~ "Neutral",
      v1_dose1_likely_BL == 4 ~ "Somewhat Likely",
      v1_dose1_likely_BL == 5 ~ "Very Likely",
      v1_dose1_likely_BL == 6 ~ "I have already received a COVID-19 Vaccine"
    )
  )
describeFactors(data$likely_full)


data <- data %>% 
  mutate(
    likely = case_when(
      v1_dose1_likely_BL %in% c(1, 2, 3) ~ "No",
      v1_dose1_likely_BL %in% c(4, 5, 6) ~ "Yes"
    )
  )
data$likely
describeFactors(data$likely)
# No      "339 (9.9%)"   
# Yes     "3,079 (89.9%)"
# Missing "7 (0.2%)"

```

```{r variable construction, include = F}
## age
data$bl14_dob_month_BL
data$bl14_dob_year_BL

data$dob <- paste(data$bl14_dob_year_BL, data$bl14_dob_month_BL, "01", sep = "-")
data$dob <- as.Date(data$dob, format = "%Y-%m-%d")
data$bl_completed_date_BL <- as.Date(as.character(data$bl_completed_date_BL), format = "%Y-%m-%d")
# 
summary(data$dob)

data$bl14_dob_month_BL[data$bl14_dob_year_BL == "1992.06"& !is.na(data$bl14_dob_year_BL)] <- 06
data$bl14_dob_year_BL[data$bl14_dob_year_BL == "1992.06"& !is.na(data$bl14_dob_year_BL)] <- 1992

data$bl14_dob_month_BL[!is.na(data$bl14_dob_year_BL) & is.na(data$bl14_dob_month_BL)] <- 01
data$dob[which(data$dob == "0026-03-01")] <- NA
data$dob[data$bl14_dob_year_BL >= 2020 & !is.na(data$bl14_dob_year_BL)] <- NA
data$dob <- as.Date(data$dob)

data$m_age <- data$bl_completed_date_BL - data$dob
data$m_age <- as.numeric(data$m_age)/365.25
summary(data$m_age)
data <- data %>% 
  mutate(
    age_cat = case_when(
      m_age <25 ~ "20-24",
      m_age <30 ~ "25-29",
      m_age <35 ~ "30-34",
      m_age <40 ~ "35-39",
      m_age <45 ~ "40-44",
      m_age >=45 ~ "45+"
    )
  )
describeFactors(data$age_cat)

## single parent
data$bl18_parent_alone_BL
describeFactors(data$bl18_parent_alone_BL)
data <- data %>%
  mutate(
    single = case_when(
      bl18_parent_alone_BL == 1 ~ "Parent alone",
      bl18_parent_alone_BL == 2 ~ "With another person",
      bl18_parent_alone_BL == 997 ~ "Prefer not to answer"
    )
  )
describeFactors(data$single)

## Obstetric History 

summary(data$bl37_timespreg_BL)
summary(data$bl37_timespreg_unknown___999_BL)
describeFactors(data$bl37_timespreg_unknown___999_BL)
#note that two people selected "unknown" for "How many times have you been pregnant?"
mean(data$bl37_timespreg_BL, na.rm= TRUE)
sd(data$bl37_timespreg_BL, na.rm=TRUE)
range(data$bl37_timespreg_BL, na.rm=TRUE)

length(which(data$bl37_timespreg_BL == "0"))

# now to make gravidity a categorical variable and analyze it that way

data <- data %>% 
  mutate(
    gravid_cat = case_when(
      bl37_timespreg_BL < 2 ~ "Primigravida",
      bl37_timespreg_BL >= 2 ~ "Multigravidas",
    )
  )

describeFactors(data$gravid_cat)
data$gravid_cat <- factor(data$gravid_cat, levels = c("Multigravidas", "Primigravida"))


#and for live births: 

summary(data$bl38_livebirths_BL)
summary(data$bl38_livebirths_unknown___999_BL)
describeFactors(data$bl38_livebirths_unknown___999_BL)
describeFactors(data$bl38_livebirths_BL)

mean(data$bl38_livebirths_BL, na.rm=TRUE)
sd(data$bl38_livebirths_BL, na.rm=TRUE)
range(data$bl38_livebirths_BL, na.rm=TRUE)

# now as a categorical variable 
library(dplyr)

data <- data %>% 
  mutate(
    livebirth_cat = case_when(
      bl38_livebirths_BL <1 ~ "No Live Births",
      bl38_livebirths_BL == 1 ~ "one previous live birth",
      bl38_livebirths_BL >=2 ~ "At least two previous live births",
      TRUE ~ as.character(bl38_livebirths_BL)
    )
  )

describeFactors(data$livebirth_cat)

## ethnicity
data$bl19_ethnicity___1_BL
data <- data %>% 
  mutate(
    eth = case_when(
      bl19_ethnicity___2_BL == 1 ~ "African/Caribbean/Black",
      bl19_ethnicity___3_BL == 1 ~ "Hispanic/Latino/Latina",
      bl19_ethnicity___4_BL == 1 ~ "East Asian",
      bl19_ethnicity___5_BL == 1 ~ "South Asian",
      bl19_ethnicity___6_BL == 1 ~ "South East Asian",
      bl19_ethnicity___7_BL == 1 ~ "West Central Asian/Middle Eastern",
      bl19_ethnicity___8_BL == 1 ~ "Indigenous originating from North America",
      bl19_ethnicity___9_BL == 1 ~ "Indigneous originating from outside North America",
      bl19_ethnicity___10_BL == 1 ~ "Mixed",
      bl19_ethnicity___998_BL == 1 ~ "Other",
      bl19_ethnicity___997_BL == 1 ~ "Prefer not to answer",
      bl19_ethnicity___999_BL == 1 ~ "Unknown",
      bl19_ethnicity___1_BL == 1 ~ "White/Caucasian"
    )
  )

# data <- data %>% 
#   mutate(
#     eth = case_when(
#       bl19_ethnicity___997_BL == 1 ~ "Prefer not to answer",
#       bl19_ethnicity___999_BL == 1 ~ "Unknown",
#     )
#   )

describeFactors(data$bl19_ethnicity___1_BL)
describeFactors(data$bl19_ethnicity___2_BL)
describeFactors(data$bl19_ethnicity___3_BL)
describeFactors(data$bl19_ethnicity___4_BL)
describeFactors(data$bl19_ethnicity___5_BL)
describeFactors(data$bl19_ethnicity___6_BL)
describeFactors(data$bl19_ethnicity___7_BL)
describeFactors(data$bl19_ethnicity___8_BL)
describeFactors(data$bl19_ethnicity___9_BL)
describeFactors(data$bl19_ethnicity___10_BL)
describeFactors(data$bl19_ethnicity___998_BL)
describeFactors(data$bl19_ethnicity___997_BL)
describeFactors(data$bl19_ethnicity___999_BL)

describeFactors(data$eth)
data <- data %>% 
  mutate(
    eth2 = case_when(
      eth == "Prefer not to answer" ~ NA_character_,
      eth == "Unknown" ~ NA_character_,
      TRUE ~ eth
    )
  )
describeFactors(data$eth2)
data$eth2 <- factor(data$eth2, levels = c("White/Caucasian", "East Asian", "South Asian", "South East Asian", "Hispanic/Latino/Latina", "African/Caribbean/Black", "West Central Asian/Middle Eastern", "Other"))


data$bl19_ethnicity___1_BL <- factor(data$bl19_ethnicity___1_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___2_BL <- factor(data$bl19_ethnicity___2_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___3_BL <- factor(data$bl19_ethnicity___3_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___4_BL <- factor(data$bl19_ethnicity___4_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___5_BL <- factor(data$bl19_ethnicity___5_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___6_BL <- factor(data$bl19_ethnicity___6_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___7_BL <- factor(data$bl19_ethnicity___7_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___8_BL <- factor(data$bl19_ethnicity___8_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___9_BL <- factor(data$bl19_ethnicity___9_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___10_BL <- factor(data$bl19_ethnicity___10_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___997_BL <- factor(data$bl19_ethnicity___997_BL, levels = c(0,1), labels = c(0,1))
data$bl19_ethnicity__998_BL <- factor(data$bl19_ethnicity___998_BL, levels = c(0,1), labels = c("No", "Yes"))
data$bl19_ethnicity___999_BL <- factor(data$bl19_ethnicity___999_BL, levels = c(0,1), labels = c(0,1))

#make new "other" variable to include indigenous and mixed
data <- data %>%
  mutate(
    other_new = case_when(
      bl19_ethnicity___8_BL == 1 ~ "Other",
      bl19_ethnicity___9_BL == 1 ~ "Other", 
      bl19_ethnicity___10_BL == 1 ~ "Other",
      bl19_ethnicity___998_BL== 1 ~ "Other",
      bl19_ethnicity___8_BL == 0 ~ "Not Other",
      bl19_ethnicity___9_BL == 0 ~ "Not Other", 
      bl19_ethnicity___10_BL == 0 ~ "Not Other",
      bl19_ethnicity___998_BL== 0 ~ "Not Other",))

describeFactors(data$other_new)


## gender
describeFactors(data$bl20_gender_BL)
describeFactors(data$bl20_gender_other_BL)

data <- data %>% 
  mutate(
    gender = case_when(
      bl20_gender_BL == 1 ~ "Woman",
      !is.na(bl20_gender_other_BL) ~ "Nonbinary/Genderqueer",
      bl20_gender_BL == 3 ~ "Nonbinary/Genderqueer",
      bl20_gender_BL == 998 ~ "Nonbinary/Genderqueer",
      TRUE ~ NA_character_
    )
  )
describeFactors(data$gender)
data$gender <- factor(data$gender, levels = c("Woman", "Nonbinary/Genderqueer"))

## Country of birth
describeFactors(data$bl15_country_born_BL)
data$bl15_country_born_BL <- factor(data$bl15_country_born_BL, levels = c(1, 2, 3, 4, 998), labels = c("Canada", "Mexico", "United Kingdom", "United States of America", "Other"))

## province of residence
describeFactors(data$bl16a_province_res_BL)
data$bl16a_province_res_BL <- factor(data$bl16a_province_res_BL, levels = c(1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13), labels = c("AB", "BC", "MB", "NB", "NL", "NT", "NS", "NU", "ON", "PE", "QC", "SK", "YK"))

data <- data %>% 
  mutate(
    prov_cat = case_when(
      bl16a_province_res_BL %in% c("NB", "NL", "NS", "PE") ~ "Atlantic Provinces",
      bl16a_province_res_BL %in% c("BC", "YK") ~ "BC/YK",
      TRUE ~ as.character(bl16a_province_res_BL)
    )
  )
describeFactors(data$prov_cat)

## education
data$bl123_education_BL
describeFactors(data$bl23_education_BL)
data$bl23_education_BL <- factor(data$bl23_education_BL, levels = c(1, 2, 3, 4, 5, 6, 7, 8, 997, 999), labels = c("Less than high school graduation", "High school graduation", "Trade certificate/Vocational", "Apprenticeship", "Non-University certificate or diploma", "Community college/CEGEP", "Bachelor's degree", "Graduate degree", NA, NA))

## combine
data$bl23_education_BL <- factor(data$bl23_education_BL)
levels(data$bl23_education_BL)[c(1, 2)] <- "High school or less"
levels(data$bl23_education_BL)[c(2, 3, 4, 5)] <- "Trade/Vocational/Apprenticeship/Certificate/College/CEGEP"

## employment
describeFactors(data$bl22_employ_BL)
data$bl22_employ_BL <- factor(data$bl22_employ_BL, levels = c(1, 2, 3, 4, 5, 6, 7, 8, 997, 998), labels = c("Employed", "Enrolled in College/University", "Volunteering", "Homemaker", "On leave", "Retired", "Unemployed", "Unable to work", "Prefer not to answer", "Other"))

# Lump unemployed, unable to work, and retired
# Lump other, prefer not to answer, unknown, and homemaker

data <- data %>% 
  mutate(
    employ_cat = case_when(
      bl22_employ_BL %in% c("Unemployed", "Unable to work", "Retired") ~ "Not working",
      bl22_employ_BL %in% c("Prefer not to answer", "Other", "Homemaker", "Volunteering") ~ "Other",
      is.na(bl22_employ_BL) ~ "Other",
      TRUE ~ as.character(bl22_employ_BL)
    )
  )

describeFactors(data$employ_cat)

## Other descriptive analyses

# How likely are you to receive the vaccine? 

data <- data %>% 
   mutate(
     likely = case_when(
       v1_dose1_likely_BL %in% c(1, 2, 3) ~ "No",
       v1_dose1_likely_BL %in% c(4, 5, 6) ~ "Yes"
     )
   )
describeFactors(data$likely)
describeFactors(data$v1_dose1_likely_BL)

# Which vaccine did you receive? (First dose)
describeFactors(data$v1a_dose1_type_BL)
describeFactors(data$v1a_dose1_type_other_BL)

data$v1a_dose1_type_BL <- factor(data$v1a_dose1_type_BL, levels = c(1, 2, 3, 4, 5, 998, 999), labels = c("Pfizer-BioNTech", "Moderna", "AstraZeneca/COVISHIELD", "Johnson & Johnson/Janssen", "Novavax", "Other", "Unknown"))
describeFactors(data$v1a_dose1_type_BL)

# Have you received a second dose? 

describeFactors(data$v1b_dose2_BL)
data$v1b_dose2_BL <- factor(data$v1b_dose2_BL, levels = c(0, 1), labels = c("No", "Yes"))


# How likely are you to receive a second dose when offered? 

describeFactors(data$v1c_dose2_likely_BL)
data$v1c_dose2_likely_BL <- factor(data$v1c_dose2_likely_BL, levels = c(1, 2, 3, 4, 5), labels = c("Very Unlikely", "Unlikely", "Neutral", "Likely", "Very Likely"))

# When you are not preg/lactating, do you receive all recommended vaccines?

data$v2_notpreg_vaccines_BL
describeFactors(data$v2_notpreg_vaccines_BL)
data$v2_notpreg_vaccines_BL <- factor(data$v2_notpreg_vaccines_BL, levels = c(0, 1, 999), labels = c("No", "Yes", "Not Sure"))

# When you are pregnant/lactating do you receive all recommended vaccines?

describeFactors(data$v3_notpreg_vaccines_BL)
data$v3_notpreg_vaccines_BL <- factor(data$v3_notpreg_vaccines_BL, levels = c(0, 1, 999), labels = c("No", "Yes", "Not sure"))

#Thinking back to before the beginning of the COVID-19 pandemic (December 2019), how much did you value vaccines? 

describeFactors(data$v4_before_value_BL)
data$v4_before_value_BL <- as.numeric(data$v4_before_value_BL)

summary(data$v4_before_value_BL)
data.vacc.value <- data %>% 
  ungroup() %>% 
  summarise(across(v4_before_value_BL, list(mean = mean, sd = sd), na.rm = TRUE))

data.vacc.value <- t(data.vacc.value)
summary(data.vacc.value)


# 	Today, how much do you value vaccines? 

describeFactors(data$v5_today_value_BL)
data$v5_today_value_BL <- as.numeric(data$v5_today_value_BL)

data.value.now <- data %>% 
  ungroup() %>% 
  summarise(across(v5_today_value_BL, list(mean = mean, sd = sd), na.rm = TRUE))

summary(data$v5_today_value_BL)

data.value.now <- t(data.value.now)


# Have you received the influenza vaccine in the past 5 years?	 

describeFactors(data$v6_flu_BL)
data$v6_flu_BL <- factor(data$v6_flu_BL, levels = c(1,2,3,4,999), labels = c("Never", "1-2 times", "3-4 times", "Every year", "Don't know"))

# Where do you get your healthcare information? 
# (select all that apply)

describeFactors(data$v7_healthinfo___1_BL)
describeFactors(data$v7_healthinfo___2_BL)
describeFactors(data$v7_healthinfo___3_BL)
describeFactors(data$v7_healthinfo___4_BL)
describeFactors(data$v7_healthinfo___5_BL)
describeFactors(data$v7_healthinfo___6_BL)
describeFactors(data$v7_healthinfo___7_BL)
describeFactors(data$v7_healthinfo___8_BL)

data$v7_healthinfo___1_BL <- factor(data$v7_healthinfo___1_BL, levels = c(0,1), labels = c("No", "Yes"))
data$v7_healthinfo___2_BL <- factor(data$v7_healthinfo___2_BL, levels = c(0,1), labels = c("No", "Yes"))
data$v7_healthinfo___3_BL <- factor(data$v7_healthinfo___3_BL, levels = c(0,1), labels = c("No", "Yes"))
data$v7_healthinfo___4_BL <- factor(data$v7_healthinfo___4_BL, levels = c(0,1), labels = c("No", "Yes"))
data$v7_healthinfo___5_BL <- factor(data$v7_healthinfo___5_BL, levels = c(0,1), labels = c("No", "Yes"))
data$v7_healthinfo___6_BL <- factor(data$v7_healthinfo___6_BL, levels = c(0,1), labels = c("No", "Yes"))
data$v7_healthinfo___7_BL <- factor(data$v7_healthinfo___7_BL, levels = c(0,1), labels = c("No", "Yes"))
data$v7_healthinfo___8_BL <- factor(data$v7_healthinfo___8_BL, levels = c(0,1), labels = c("No", "Yes"))


data <- data %>% 
  mutate(
    health.info = case_when(
      v7_healthinfo___1_BL == 1 ~ "Family Physician",
      v7_healthinfo___2_BL == 1 ~ "Prenatal care provider",
      v7_healthinfo___3_BL == 1 ~ "Other healthcare provider",
      v7_healthinfo___4_BL == 1 ~ "Family & friends",
      v7_healthinfo___5_BL == 1 ~ "Social media",
      v7_healthinfo___6_BL == 1 ~ "Traditional media (the news)",
      v7_healthinfo___7_BL == 1 ~ "Google search",
      v7_healthinfo___8_BL == 1 ~ "Government",
    )
  )
describeFactors(data$health.info)


# l.	The health information I receive from…(very reliablevery unreliable)
  # i.	my family physician is..

describeFactors(data$v8_healthinfo_famphys_BL)

as.numeric(data$v8_healthinfo_famphys_BL)

data <- data %>%
  mutate(
    famphys = case_when(
     v8_healthinfo_famphys_BL %in% 1 ~ 5,
     v8_healthinfo_famphys_BL %in% 2 ~ 4,
     v8_healthinfo_famphys_BL %in% 3 ~ 3,
     v8_healthinfo_famphys_BL %in% 4 ~ 2,
     v8_healthinfo_famphys_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v8_healthinfo_famphys_BL)
     ))

data$famphys <- replace(data$famphys, which(data$famphys == 999), NA)

data.famphys <- data %>% 
  ungroup() %>% 
  summarise(across(famphys, list(mean = mean, sd = sd), na.rm = TRUE))

data.famphys<- t(data.famphys)

summary(data.famphys)

data$v8_healthinfo_famphys_BL <- factor(data$v8_healthinfo_famphys_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA"))


as.numeric(data$v8_healthinfo_famphys_BL)

  # ii.	my prenatal care provider is…

describeFactors(data$v9_healthinfo_prenatal_BL)
data$v9_healthinfo_prenatal_BL <- factor(data$v9_healthinfo_prenatal_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA"))

as.numeric(data$v9_healthinfo_prenatal_BL)

data <- data %>%
  mutate(
    prenatal = case_when(
     v9_healthinfo_prenatal_BL %in% 1 ~ 5,
     v9_healthinfo_prenatal_BL %in% 2 ~ 4,
     v9_healthinfo_prenatal_BL %in% 3 ~ 3,
     v9_healthinfo_prenatal_BL %in% 4 ~ 2,
     v9_healthinfo_prenatal_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v9_healthinfo_prenatal_BL)
     ))

data$prenatal <- replace(data$prenatal, which(data$prenatal == 999), NA)

data.prenatal <- data %>% 
  ungroup() %>% 
  summarise(across(prenatal, list(mean = mean, sd = sd), na.rm = TRUE))

data.prenatal <- t(data.prenatal)
																					

  # iii.	my other healthcare provider is…

describeFactors(data$v10_healthinfo_otherhcp_BL)
data$v10_healthinfo_otherhcp_BL <- factor(data$v10_healthinfo_otherhcp_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA"))  


as.numeric(data$v10_healthinfo_otherhcp_BL)

data <- data %>%
  mutate(
    other.hcp = case_when(
     v10_healthinfo_otherhcp_BL %in% 1 ~ 5,
     v10_healthinfo_otherhcp_BL %in% 2 ~ 4,
     v10_healthinfo_otherhcp_BL %in% 3 ~ 3,
     v10_healthinfo_otherhcp_BL %in% 4 ~ 2,
     v10_healthinfo_otherhcp_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v10_healthinfo_otherhcp_BL)
     ))

data$other.hcp <- replace(data$other.hcp, which(data$other.hcp == 999), NA)

data.other.hcp <- data %>% 
  ungroup() %>% 
  summarise(across(other.hcp, list(mean = mean, sd = sd), na.rm = TRUE))

data.other.hcp <- t(data.other.hcp)

# iv.	family & friends is…

describeFactors(data$v11_healthinfo_fam_BL)
data$v11_healthinfo_fam_BL <- factor(data$v11_healthinfo_fam_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA"))


as.numeric(data$v11_healthinfo_fam_BL)

data <- data %>%
  mutate(
    famfri = case_when(
     v11_healthinfo_fam_BL %in% 1 ~ 5,
     v11_healthinfo_fam_BL %in% 2 ~ 4,
     v11_healthinfo_fam_BL %in% 3 ~ 3,
     v11_healthinfo_fam_BL %in% 4 ~ 2,
     v11_healthinfo_fam_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v11_healthinfo_fam_BL)
     ))

data$famfri <- replace(data$famfri, which(data$famfri == 999), NA)

data.famfri <- data %>% 
  ungroup() %>% 
  summarise(across(famfri, list(mean = mean, sd = sd), na.rm = TRUE))

data.famfri <- t(data.famfri)

  # v.	social media is…

describeFactors(data$v12_healthinfo_social_BL)
data$v12_healthinfo_social_BL <- factor(data$v12_healthinfo_social_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA"))  

as.numeric(data$v12_healthinfo_social_BL)

data <- data %>%
  mutate(
    social = case_when(
     v12_healthinfo_social_BL %in% 1 ~ 5,
     v12_healthinfo_social_BL %in% 2 ~ 4,
     v12_healthinfo_social_BL %in% 3 ~ 3,
     v12_healthinfo_social_BL %in% 4 ~ 2,
     v12_healthinfo_social_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v12_healthinfo_social_BL)
     ))

data$social <- replace(data$social, which(data$social == 999), NA)

data.social <- data %>% 
  ungroup() %>% 
  summarise(across(social, list(mean = mean, sd = sd), na.rm = TRUE))

data.social <- t(data.social)


# vi.	traditional media (the news) is…

describeFactors(data$v13_healthinfo_media_BL)
data$v13_healthinfo_media_BL <- factor(data$v13_healthinfo_media_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA"))  


as.numeric(data$v13_healthinfo_media_BL)

data <- data %>%
  mutate(
    news = case_when(
     v13_healthinfo_media_BL %in% 1 ~ 5,
     v13_healthinfo_media_BL %in% 2 ~ 4,
     v13_healthinfo_media_BL %in% 3 ~ 3,
     v13_healthinfo_media_BL %in% 4 ~ 2,
     v13_healthinfo_media_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v13_healthinfo_media_BL)
     ))

data$news <- replace(data$news, which(data$news == 999), NA)

data.news <- data %>% 
  ungroup() %>% 
  summarise(across(news, list(mean = mean, sd = sd), na.rm = TRUE))

data.news <- t(data.news)


  # vii.	Google search is…

describeFactors(data$v14_healthinfo_google_BL)
data$v14_healthinfo_google_BL <- factor(data$v14_healthinfo_google_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA"))  

as.numeric(data$v14_healthinfo_google_BL)

data <- data %>%
  mutate(
    google = case_when(
     v14_healthinfo_google_BL %in% 1 ~ 5,
     v14_healthinfo_google_BL %in% 2 ~ 4,
     v14_healthinfo_google_BL %in% 3 ~ 3,
     v14_healthinfo_google_BL %in% 4 ~ 2,
     v14_healthinfo_google_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v14_healthinfo_google_BL)
     ))

data$google <- replace(data$google, which(data$google == 999), NA)

data.google <- data %>% 
  ungroup() %>% 
  summarise(across(google, list(mean = mean, sd = sd), na.rm = TRUE))

data.google <- t(data.google)


# viii.	the government is…

describeFactors(data$v15_healthinfo_gov_BL)
data$v15_healthinfo_gov_BL <- factor(data$v15_healthinfo_gov_BL, levels = c(1,2,3,4,5,999), labels = c("Very reliable", "Somewhat reliable", "Neutral", "Somewhat unreliable", "Very unreliable", "NA")) 


as.numeric(data$v15_healthinfo_gov_BL)

data <- data %>%
  mutate(
    gov = case_when(
     v15_healthinfo_gov_BL %in% 1 ~ 5,
     v15_healthinfo_gov_BL %in% 2 ~ 4,
     v15_healthinfo_gov_BL %in% 3 ~ 3,
     v15_healthinfo_gov_BL %in% 4 ~ 2,
     v15_healthinfo_gov_BL %in% 5 ~ 1,
     TRUE ~ as.numeric(v15_healthinfo_gov_BL)
     ))

data$gov <- replace(data$gov, which(data$gov == 999), NA)

data.gov <- data %>% 
  ungroup() %>% 
  summarise(across(gov, list(mean = mean, sd = sd), na.rm = TRUE))

data.gov<- t(data.gov)


```

```{r TPB, include = F}
# sum to form attitude scale
# all attitudes anchored in same direction
# v18 to v28

a.ca <- alpha(data[, c("v18_serious_BL", "v19_serious_preg_BL", "v20_beneficial_BL", "v21_beneficial_preg_BL", "v22_tested_BL", "v23_tested_preg_BL", "v24_safe_BL", "v25_safe_preg_BL", "v26_safe_fetus_BL", "v27_effective_BL", "v28_effective_preg_BL")])
a.ca


#          lower alpha upper
# Feldt     0.88  0.89  0.89 


data <- data %>% 
  rowwise() %>% 
  mutate(ATT = sum(c(v18_serious_BL, v19_serious_preg_BL, v20_beneficial_BL, v21_beneficial_preg_BL, v22_tested_BL, v23_tested_preg_BL, v24_safe_BL, v25_safe_preg_BL, v26_safe_fetus_BL, v27_effective_BL, v28_effective_preg_BL)))
summary(data$ATT)

data.att <- data %>% 
  ungroup() %>% 
  summarise(across(c(v18_serious_BL, v19_serious_preg_BL, v20_beneficial_BL, v21_beneficial_preg_BL, v22_tested_BL, v23_tested_preg_BL, v24_safe_BL, v25_safe_preg_BL, v26_safe_fetus_BL, v27_effective_BL, v28_effective_preg_BL, ATT), list(mean = mean, sd = sd), na.rm = TRUE))
(data.att2 <- t(data.att))



describeFactors(data$v18_serious_BL)
describeFactors(data$v19_serious_preg_BL)
describeFactors(data$v20_beneficial_BL)
describeFactors(data$v21_beneficial_preg_BL)
describeFactors(data$v22_tested_BL)
describeFactors(data$v23_tested_preg_BL)
describeFactors(data$v24_safe_BL)
describeFactors(data$v25_safe_preg_BL)
describeFactors(data$v26_safe_fetus_BL)
describeFactors(data$v27_effective_BL)
describeFactors(data$v28_effective_preg_BL)


# direct subjective norms
# v29 to v30
describeFactors(data$v29_important_BL)
mean(data$v29_important_BL, na.rm = TRUE)
sd(data$v29_important_BL, na.rm = TRUE)


describeFactors(data$v30_socialpressure_BL)
mean(data$v30_socialpressure_BL, na.rm = TRUE)
sd(data$v30_socialpressure_BL, na.rm = TRUE)

snd.ca <- alpha(data[, c("v29_important_BL", "v30_socialpressure_BL")])
snd.ca
#          lower alpha upper
# Feldt    -0.05  0.02  0.08
# these 2 are not agreeing and should be reported separately

data.dsn <- data %>% 
  ungroup() %>% 
  summarise(across(c(v29_important_BL:v30_socialpressure_BL), list(mean = mean, sd = sd), na.rm = TRUE))

(data.dsn2 <- t(data.dsn))


# perceived behavioural control
# v39 to v41
data$v39_easilyreceive_BL[which(data$v1_dose1_likely_BL != 6)]
describeFactors(data$v39_easilyreceive_BL[which(data$v1_dose1_likely_BL != 6)])
data$v40_choice_BL[which(data$v1_dose1_likely_BL != 6)]
data$v41_control_BL[which(data$v1_dose1_likely_BL != 6)]

pbc.ca <- alpha(data[which(data$v1_dose1_likely_BL != 6), c("v39_easilyreceive_BL", "v40_choice_BL", "v41_control_BL")])
pbc.ca
#          lower alpha upper
# Feldt     0.53  0.59  0.65

data <- data %>% 
  rowwise() %>% 
  mutate(PBC = sum(c(v39_easilyreceive_BL, v40_choice_BL, v41_control_BL)))

summary(data$PBC)

data.pbc <- data %>% 
  ungroup() %>% 
  summarise(across(c(v39_easilyreceive_BL, v40_choice_BL, v41_control_BL, PBC), list(mean = mean, sd = sd), na.rm = TRUE))

(data.pbc2 <- t(data.pbc))

describeFactors(data$v39_easilyreceive_BL)
describeFactors(data$v40_choice_BL)
describeFactors(data$v41_control_BL)


# Indirect social norms (Ianna's version, no re-coding)

data$v33_partner_approve_BL <- replace(data$v33_partner_approve_BL, which(data$v33_partner_approve_BL == 999), NA)

 data$v34_partner_important_BL <- replace(data$v34_partner_important_BL, which(data$v34_partner_important_BL == 999), NA)

  data$v37_prenatal_approve_BL <- replace(data$v37_prenatal_approve_BL, which(data$v37_prenatal_approve_BL == 999), NA)
  
   data$v38_prenatal_important_BL <- replace(data$v38_prenatal_important_BL, which(data$v38_prenatal_important_BL == 999), NA)


isn.ca <- alpha(data[, c("v31_pho_approve_BL", "v32_pho_important_BL", "v33_partner_approve_BL", "v34_partner_important_BL", "v35_fam_approve_BL", "v36_fam_important_BL", "v37_prenatal_approve_BL", "v38_prenatal_important_BL")])
isn.ca
isn.ca$feldt
#       lower alpha upper
#Feldt  0.627 0.645 0.663

# describeFactors(data$v31_pho_approve_BL)
# data$v31_pho_approve_BL <- data$v31_pho_approve_BL + 3
# describeFactors(data$v32_pho_important_BL)
# describeFactors(data$v33_partner_approve_BL)
# data$v33_partner_approve_BL <- data$v33_partner_approve_BL + 3
# describeFactors(data$v34_partner_important_BL)
# describeFactors(data$v35_fam_approve_BL)
# data$v35_fam_approve_BL <- data$v35_fam_approve_BL + 3
# describeFactors(data$v36_fam_important_BL)
# describeFactors(data$v37_prenatal_approve_BL)
# data$v37_prenatal_approve_BL <- data$v37_prenatal_approve_BL + 3
# describeFactors(data$v38_prenatal_important_BL)

data.isn <- data %>% 
  ungroup() %>% 
  summarise(across(c(v31_pho_approve_BL:v38_prenatal_important_BL) , list(mean = mean, sd = sd), na.rm = TRUE))

(data.isn2 <- t(data.isn))

# 
# 
# # Arianne's analysis
# # PHO
# # 
# table(data$v31_pho_approve_BL) 
# # recode to -2 to 2
 data$v31_pho_approve_BL2 <- data$v31_pho_approve_BL-3
# 
# table(data$v32_pho_important_BL)
# # then multiply by v32_pho_important
 data$SNI.PHO <- data$v31_pho_approve_BL2 * data$v32_pho_important_BL
 summary(data$SNI.PHO)
# 
# describeFactors(data$v31_pho_approve_BL)
# 
# # partner
# table(data$v33_partner_approve_BL)

# # recode to -2 to 2
 data$v33_partner_approve_BL2 <- data$v33_partner_approve_BL-3
# 
# # then multiply by v34_partner_important
# 
# table(data$v34_partner_important_BL)
#       

# 
 data$SNI.PART <- data$v33_partner_approve_BL2 * data$v34_partner_important_BL
 summary(data$SNI.PART)
# 
# 
# # Friends/fam
# table(data$v35_fam_approve_BL)
# # recode to -2 to 2
 data$v35_fam_approve_BL2 <- data$v35_fam_approve_BL-3
# 
# # then multiply by v36_fam_important
# table(data$v36_fam_important_BL)
# 
 data$SNI.FRI <- data$v35_fam_approve_BL2 * data$v36_fam_important_BL
 summary(data$SNI.FRI)
# 
# 
# # prenatal care provider
# table(data$v37_prenatal_approve_BL)
# 

# # recode to -2 to 2
 data$v37_prenatal_approve_BL2 <- data$v37_prenatal_approve_BL-3
# 
# # then multiply by v38_prenatal_important
# table(data$v38_prenatal_important_BL)
# 

# 
 data$SNI.PRE <- data$v37_prenatal_approve_BL2 * data$v38_prenatal_important_BL
 summary(data$SNI.PRE)


sn.ca <- alpha(data[, c("SNI.PHO", "SNI.PART", "SNI.FRI", "SNI.PRE")])
sn.ca


data <- data %>% 
  rowwise() %>% 
  mutate(isn.aug = sum(c(v31_pho_approve_BL2, v32_pho_important_BL, v33_partner_approve_BL2, v34_partner_important_BL, v35_fam_approve_BL2, v36_fam_important_BL, v37_prenatal_approve_BL2, v38_prenatal_important_BL)))

summary(data$isn.aug)

data.isn.aug <- data %>% 
  ungroup() %>% 
  summarise(across(c(v31_pho_approve_BL2, v32_pho_important_BL, v33_partner_approve_BL2, v34_partner_important_BL, v35_fam_approve_BL2, v36_fam_important_BL, v37_prenatal_approve_BL2, v38_prenatal_important_BL, isn.aug), list(mean = mean, sd = sd), na.rm = TRUE))

(data.isn.aug <- t(data.isn.aug))

#          lower alpha upper
# Feldt     0.581   0.603  0.625

data <- data %>% 
  rowwise() %>% 
  mutate(SNI.TOT = sum(SNI.PHO, SNI.PART, SNI.FRI, SNI.PRE))

summary(data$SNI.TOT)
sd(data$SNI.TOT, na.rm=TRUE)

 #   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
 # -34.00   21.00   30.00   26.95   35.00   40.00     192

data.isn <- data %>% 
  ungroup() %>% 
  summarise(across(c(v31_pho_approve_BL:v38_prenatal_important_BL, SNI.PHO, SNI.PART, SNI.FRI, SNI.PRE, SNI.TOT) , list(mean = mean, sd = sd), na.rm = TRUE))

(data.isn2 <- t(data.isn))


```

```{r WHO scales, include = F}
# WHO scale
# new vaccine more risk, concerned about adverse effects 8 and 9 = risks 

describeFactors(data$v16_risks_BL)
length(data$v16_risks_BL)

describeFactors(data$v17_effects_BL)
length(data$v17_effects_BL)


mean(data$v16_risks_BL, na.rm = TRUE)
sd(data$v16_risks_BL, na.rm = TRUE)

mean(data$v17_effects_BL, na.rm = TRUE)
sd(data$v17_effects_BL, na.rm = TRUE)
# get the average scores


data <- data %>% 
  rowwise() %>% 
  mutate(VHS_risk = sum(c(v16_risks_BL, v17_effects_BL)))

summary(data$VHS_risk)


VHS_risk <- alpha(data[, c("v16_risks_BL", "v17_effects_BL")])
VHS_risk$feldt
#          lower alpha upper
# Feldt    0.626 0.651 0.673

data.who <- data %>% 
  ungroup() %>% 
  summarise(across(c(v16_risks_BL, v17_effects_BL, VHS_risk), list(mean = mean, sd = sd), na.rm = TRUE))

(data.who <- t(data.who))
data.who

```


```{r table by vaccine intentions, include = F}

getT1Stat <- function(varname, digits=2, useNA = "ifany"){
  getDescriptionStatsBy(data[, varname], 
                        data$likely, 
                        add_total_col=TRUE,
                        show_all_values=TRUE, 
                        statistics = TRUE,
                        hrzl_prop = TRUE,
                        html=TRUE, 
                        useNA = useNA,
                        digits=digits,
                        header_count = TRUE)
}


getT1Stat <- function(varname, digits=2, useNA = "ifany"){
  getDescriptionStatsBy(data[, varname], 
                        data$likely, 
                        add_total_col=TRUE,
                        show_all_values=TRUE, 
                        statistics = TRUE,
                        html=TRUE, 
                        useNA = useNA,
                        digits=digits,
                        header_count = TRUE)
}

data$likely <- relevel(factor(data$likely), ref = "No") ## switch the directionality here

# data <- data[-which(is.na(data$likely)),]
table_data <- list()

data <- as.data.frame(data)

library(dplyr)
library(Gmisc)
library(Hmisc)
library(htmlTable)


# Get the basic stats

table_data[["Age"]] <- getT1Stat("age_cat", 1,)
table_data[["Single"]] <- getT1Stat("single", 1)
table_data[["Gravidity"]] <- getT1Stat("gravid_cat", 1)
table_data[["Live Births"]] <- getT1Stat("livebirth_cat", 1)

table_data[["Ethnicitiy Caucasian"]] <- getT1Stat("bl19_ethnicity___1_BL")
table_data[["Ethnicitiy African/Black"]] <- getT1Stat("bl19_ethnicity___2_BL")
table_data[["Ethnicitiy Hispanic"]] <- getT1Stat("bl19_ethnicity___3_BL")
table_data[["Ethnicitiy East Asian"]] <- getT1Stat("bl19_ethnicity___4_BL")
table_data[["Ethnicitiy South Asian"]] <- getT1Stat("bl19_ethnicity___5_BL")
table_data[["Ethnicitiy South East Asian"]] <- getT1Stat("bl19_ethnicity___6_BL")
table_data[["Ethnicitiy Middle Eastern"]] <- getT1Stat("bl19_ethnicity___7_BL")
table_data[["Ethnicitiy Indigenous NA"]] <- getT1Stat("bl19_ethnicity___8_BL")
table_data[["Ethnicitiy Indigenous outside NA"]] <- getT1Stat("bl19_ethnicity___9_BL")
table_data[["Ethnicitiy Mixed"]] <- getT1Stat("bl19_ethnicity___10_BL")
table_data[["Ethnicitiy Prefer not to answer"]] <- getT1Stat("bl19_ethnicity___997_BL")
table_data[["Ethnicitiy Other"]] <- getT1Stat("bl19_ethnicity___998_BL")
table_data[["ethnicity unknown"]] <- getT1Stat("bl19_ethnicity___999_BL")
table_data[["Ethnicity Other_new"]] <- getT1Stat("other_new")


table_data[["Ethnicity"]] <- getT1Stat("eth2", 1)
table_data[["Gender"]] <- getT1Stat("gender", 1)
table_data[["Country of Birth"]] <- getT1Stat("bl15_country_born_BL", 1)
table_data[["Province of residence"]] <- getT1Stat("prov_cat", 1)
table_data[["Education"]] <- getT1Stat("bl23_education_BL", 1)
table_data[["Employment"]] <- getT1Stat("employ_cat", 1)

table_data[["When you are not pregnant/lactating, do you receive all recommended vaccines?"]] <- getT1Stat("v2_notpreg_vaccines_BL", 1)
table_data[["When you are pregnant/lactating, do you receive all recommended vaccines?"]] <- getT1Stat("v3_notpreg_vaccines_BL",1)
table_data[["Thinking back to before COVID-19, how much did you value vaccines? New"]] <- getT1Stat("v4_before_value_BL", 1)
table_data[["Today, how much do you value vaccines? New"]] <- getT1Stat("v5_today_value_BL", 1)
table_data[["How you received the influenza vaccine in the past 5 years?"]] <- getT1Stat("v6_flu_BL", 1)

table_data[["Where do you get your healthcare information Physician?"]] <- getT1Stat("v7_healthinfo___1_BL", 1)
table_data[["Where do you get your healthcare information prenatal care provider?"]] <- getT1Stat("v7_healthinfo___2_BL", 1)
table_data[["Where do you get your healthcare information other HCP?"]] <- getT1Stat("v7_healthinfo___3_BL", 1)
table_data[["Where do you get your healthcare information FamFri?"]] <- getT1Stat("v7_healthinfo___4_BL", 1)
table_data[["Where do you get your healthcare information social media?"]] <- getT1Stat("v7_healthinfo___5_BL", 1)
table_data[["Where do you get your healthcare information the news?"]] <- getT1Stat("v7_healthinfo___6_BL", 1)
table_data[["Where do you get your healthcare information google?"]] <- getT1Stat("v7_healthinfo___7_BL", 1)
table_data[["Where do you get your healthcare information government?"]] <- getT1Stat("v7_healthinfo___8_BL", 1)

table_data[["The health information I receive from my physician is... (higher value = more reliable"]] <- getT1Stat("famphys", 1)
table_data[["The health information I receive from my prenatal care provider is..."]]<- getT1Stat("prenatal", 1)
table_data[["The health information I receive from my other healthcare care provider is..."]]<- getT1Stat("other.hcp", 1)
table_data[["The health information I receive from my family and friends is..."]]<- getT1Stat("famfri", 1)
table_data[["The health information I receive from social media is......"]]<- getT1Stat("social", 1)
table_data[["The health information I receive from traditional news is..."]]<- getT1Stat("news", 1)
table_data[["The health information I receive from google search is ..."]]<- getT1Stat("google", 1)
table_data[["The health information I receive from the government is..."]]<- getT1Stat("gov", 1)


table_data[["WHO scale: Vaccine Risks"]] <- getT1Stat("VHS_risk", 1)
table_data[["Attitudes to COVID-19 Vaccine"]] <- getT1Stat("ATT", 1)
table_data[["Perceived Behavioural Control"]] <- getT1Stat("PBC", 1)
table_data[["Direct Social Norms: Most people who are important to me would think that I should receive the COVID-19 vaccine while pregnant/lactating"]] <- getT1Stat("v29_important_BL", 1)
table_data[["Direct Social Norms: I feel under social pressure to receive a COVID-19 vaccine while pregnant/lactating"]] <- getT1Stat("v30_socialpressure_BL", 1)
table_data[["Indirect Social Norms: Provincial Health Officer"]] <- getT1Stat("SNI.PHO", 1)
table_data[["Indirect Social Norms: Partner"]] <- getT1Stat("SNI.PART", 1)
table_data[["Indirect Social Norms: Friends & Family"]] <- getT1Stat("SNI.FRI", 1)
table_data[["Indirect Social Norms: Prenatal care provider"]] <- getT1Stat("SNI.PRE", 1)
table_data[["Indirect Social Norms: Total"]] <- getT1Stat("SNI.TOT", 1)
summary(table_data)


# Now merge everything into a matrix
# and create the rgroup & n.rgroup variabels
rgroup <- c()
n.rgroup <- c()
output_data <- NULL
for (varlabel in names(table_data)) {
  output_data <- rbind(output_data, 
                       table_data[[varlabel]])
  rgroup <- c(rgroup, 
              varlabel)
  n.rgroup <- c(n.rgroup, 
                nrow(table_data[[varlabel]]))
}
 
# Add a column spanner for the columns
cgroup <- c("", "Likely to receive COVID-19 vaccine")
n.cgroup <- c(1, 3)
colnames(output_data) <- gsub("[ ]*Likely to receive COVID-19 vaccine", "", colnames(output_data))
 
  htmlTable::htmlTable(output_data, align = "rrrr",
           rgroup = rgroup, n.rgroup = n.rgroup, 
           css.rgroup.sep = "", 
           cgroup = cgroup,
           n.cgroup = n.cgroup,
           rowlabel = "", 
           caption = "", 
           ctable = TRUE)  %>% htmltools::html_print()



```

## "Sensitivity Analysis" (From Gal)

Likelihood of receiving vaccine was assessed using the question: As COVID-19 vaccines have been recommended for pregnant and lactating women and people, how likely are you to receive it?

Answers of 1-2 (very unlikely to unlikely) were considered as not likely Answers of 4-5 (somewhat likely, very likely) were considered as likely. Those who already recieved a vaccine were excluded from the analysis.

There were 3,418 participants who completed the intention question, however only 484 are included in the analysis and summaries below. The breakdown of answers indicate that the vast majority had already received at least one dose (option 6) at the time of the survey:

`r kbl(table(data$v1_dose1_likely_BL, useNA = "ifany"))`



```{r table 1, include = T}
htmlTable::htmlTable(output_data, align = "rrrr",
          rgroup = rgroup, n.rgroup = n.rgroup, 
          css.rgroup.sep = "", 
          cgroup = cgroup,
          n.cgroup = n.cgroup,
          rowlabel = "", 
          caption = "", 
          ctable = TRUE) 
```

```{r model, include = F}
# logistic regression models


mod1 <- glm(likely ~ bl23_education_BL, data = data, family = binomial)
summary(mod1)
drop1(mod1, test = "Chi")

edu.ph <- emmeans(mod1, specs = "bl23_education_BL", contr = "pairwise")
summary(edu.ph)

mod2 <- glm(likely ~ VHS_risk, data = data, family = binomial)
summary(mod2)
drop1(mod2, test = "Chi")

mod3 <- glm(likely ~ ATT, data = data, family = binomial)
summary(mod3)
drop1(mod3, test = "Chi")

mod3_mean <- glm(likely ~ ATT_mean, data = data, family = binomial)
summary(mod3_mean)
drop1(mod3_mean, test = "Chi")

mod4 <- glm(likely ~ v29_important_BL, data = data, family = binomial)
summary(mod4)
drop1(mod4, test = "Chi")

mod5 <- glm(likely ~ v30_socialpressure_BL, data = data, family = binomial)
summary(mod5)
drop1(mod5, test = "Chi")

mod6 <- glm(likely ~ SNI.PHO, data = data, family = binomial)
summary(mod6)
drop1(mod6, test = "Chi")

mod7 <- glm(likely ~ SNI.PART, data = data, family = binomial)
summary(mod7)
drop1(mod7, test = "Chi")

mod8 <- glm(likely ~ SNI.FRI, data = data, family = binomial)
summary(mod8)
drop1(mod8, test = "Chi")

mod9 <- glm(likely ~ SNI.PRE, data = data, family = binomial)
summary(mod9)
drop1(mod9, test = "Chi")

mod10 <- glm(likely~ employ_cat, data=data, family=binomial)
summary(mod10)
drop1(mod10, test="Chi")

mod11 <- glm(likely~SNI.TOT, data = data, family=binomial)
summary(mod11)
drop1(mod11, test="Chi")

mod12 <- glm(likely~v2_notpreg_vaccines_BL, data=data, family = binomial)
summary(mod12)
drop1(mod12, test="Chi")

mod13 <- glm(likely~v3_notpreg_vaccines_BL, data = data, family = binomial)
summary(mod13)
drop1(mod13, test= "Chi")

mod14 <- glm(likely~v4_before_value_BL, data = data, family = binomial)
summary(mod14)
drop1(mod14, test = "Chi")

mod15 <- glm(likely ~ v5_today_value_BL, data = data, family = binomial)
summary(mod15)
drop1(mod15, test = "Chi")

mod16 <- glm(likely~v6_flu_BL, data = data, family = binomial)
summary(mod16)
drop1(mod16, test= "Chi")

mod17 <- glm(likely~famphys, data = data, family = binomial)
summary(mod17)

mod18 <- glm(likely~prenatal, data = data, family = binomial)
summary(mod18)

mod19 <- glm(likely~other.hcp, data = data, family = binomial)
summary(mod19)

mod20 <- glm(likely~famfri, data = data, family = binomial)
summary(mod20)


mod21 <- glm(likely~social, data = data, family = binomial)
summary(mod21)

mod22 <- glm(likely~news, data = data, family = binomial)
summary(mod22)

mod23 <- glm(likely~gov, data = data, family = binomial)
summary(mod23)

mod24 <- glm(likely~ gravid_cat, data = data, family = binomial)
summary(mod24)

# mod_all <- glm(likely ~ bl23_education_BL + employ_cat + VHS_risk + ATT + v29_important_BL + v30_socialpressure_BL + SNI.PHO + SNI.PART + SNI.FRI + SNI.PRE, data = data, family = binomial)

mod_all <- glm(likely ~ bl23_education_BL + employ_cat + VHS_risk + ATT + v29_important_BL+ v30_socialpressure_BL + SNI.TOT, data = data, family = binomial)

mod_all_IF <- glm(likely ~ bl23_education_BL + employ_cat + VHS_risk + ATT + v29_important_BL + v30_socialpressure_BL + SNI.PHO + SNI.PART + SNI.FRI + SNI.PRE + v2_notpreg_vaccines_BL + v3_notpreg_vaccines_BL + v4_before_value_BL +v5_today_value_BL + v6_flu_BL , data = data, family = binomial)

summary(mod_all)

data$VHS_risk_mean <- data$VHS_risk/2
data$ATT_mean <- data$ATT/11
data$PBC




```


```{r bar plots, include = TRUE}
data_reliability <- data[,c("v8_healthinfo_famphys_BL","v9_healthinfo_prenatal_BL","v10_healthinfo_otherhcp_BL","v11_healthinfo_fam_BL","v12_healthinfo_social_BL","v13_healthinfo_media_BL","v14_healthinfo_google_BL","v15_healthinfo_gov_BL","likely")]

for(i in 1:dim(data_reliability)[2]) {
  data_reliability[,i] <- as.factor(data_reliability[,i] )
}

data_reliability[data_reliability == "NA"] <- NA


data_reliability2 <- data_reliability %>% pivot_longer(cols = c("v8_healthinfo_famphys_BL","v9_healthinfo_prenatal_BL","v10_healthinfo_otherhcp_BL","v11_healthinfo_fam_BL","v12_healthinfo_social_BL","v13_healthinfo_media_BL","v14_healthinfo_google_BL","v15_healthinfo_gov_BL"),names_to = "question",values_to = "answers")

data_reliability3 <- data_reliability2 %>% group_by(question, answers) %>% summarise(n=n())

data_reliability4 <- data_reliability3 %>% pivot_wider(names_from = "answers",  values_from = "n")

data_reliability5 <- data_reliability4[,-c(7)]

library(tidyverse)
# data_reliability6 <- data_reliability5 %>% 
#    as.data.frame %>%
#    mutate(newSum = select_if(., is.numeric) %>% 
#                        reduce(`+`)) %>% 
#    mutate_if(is.numeric, list(~ ./newSum)) %>% 
#    select(-newSum)


question_text_reliability <- matrix(nrow = length(data_reliability5$question), ncol = 2, data = NA)
question_text_reliability <- as.data.frame(question_text_reliability)

colnames(question_text_reliability) <- c("question","question_text")
  
question_text_reliability$question <- data_reliability5$question
# question_text_reliability$likely <- data_reliability5$likely

# # question_text_reliability$question_text <- c("The health information I receive from my other healthcare provider is...","The health information I receive from my family & friends is...","The health information I receive from my social media is...","The health information I receive from traditional media (the news) is...","The health information I receive from a Google search is...","The health information I receive from the government is...","The health information I receive from my family physician is...","The health information I receive from my prenatal care provider is...")
# 
question_text_reliability$question_text <- c("Other healthcare provider","Family & friends","Social media","Traditional media (the news)","A Google search","The government","Family physician","Prenatal care provider")
# 
# question_text_reliability$question_text <- c("Other healthcare provider","Other healthcare provider","Family & friends","Family & friends","Social media","Social media","Traditional media (the news)","Traditional media (the news)","A Google search","A Google search","The government","The government","Family physician","Family physician","Prenatal care provider","Prenatal care provider")

data_reliability_forplot <- inner_join(data_reliability3,question_text_reliability, by = c("question"))
data_reliability_forplot <- distinct(data_reliability_forplot)

# for(i in 1:length(data_reliability_forplot$question)){
#   if(data_reliability_forplot$likely[i] == "No"){
#     data_reliability_forplot$question_text[i] <- paste(data_reliability_forplot$question_text[i], "(unlikely to vaccinate)")
#   }
#   if(data_reliability_forplot$likely[i] == "Yes"){
#         data_reliability_forplot$question_text[i] <- paste(data_reliability_forplot$question_text[i], "(likely to vaccinate)")
#   }
# }

g2 = ggplot(data = data_reliability_forplot[-which(is.na(data_reliability_forplot$answers)),],aes(x = reorder(question_text,n), y=n, fill=answers, label = n))+
  geom_col(width = 0.5)+
   geom_text(size = 3, position = position_stack(vjust = 0.5), check_overlap =TRUE,colour = "white") +
  ggtitle("Figure 3: Perceived Reliability of Healthcare Information Sources")+
  ylab("Number of Respondents")+
  coord_flip()+
  xlab("Question")+
  # scale_fill_brewer(palette="PRGn")+
  theme(legend.position="top", panel.background = element_blank(),legend.text = element_text(size = 10, colour = "black"), plot.title = element_text(size = 14, colour = "black"), legend.title = element_blank(), legend.key.size = unit(.25, "cm"), text = element_text(family = "Times New Roman"), axis.title.y = element_blank())+
  scale_fill_manual("Legend", values = c("Very unreliable" = "#6568b1","Somewhat unreliable" = "#d58942","Neutral" = "#af2322","Somewhat reliable" = "#f3c34a","Very reliable" = "#7eab56"), breaks = c("Very unreliable","Somewhat unreliable","Neutral" ,"Somewhat reliable" ,"Very reliable"))
  #scale_x_discrete(limits=c("StronglyAgree", "Agree", "DontKnow","Disagree","StronglyDisagree"))
g2
# data_reliability2 <- data_reliability %>% pivot_longer(cols =)
ggsave("g2_new.jpeg", width = 14, height = 7)

```


```{r bar plots, include = TRUE}
data_vaccines <- data[,c("v16_risks_BL","v17_effects_BL","v18_serious_BL","v19_serious_preg_BL","v20_beneficial_BL","v21_beneficial_preg_BL","v22_tested_BL","v23_tested_preg_BL","v24_safe_BL","v25_safe_preg_BL","v26_safe_fetus_BL","v27_effective_BL","v28_effective_preg_BL","v29_important_BL","v30_socialpressure_BL")]

data_vaccines2 <- data_vaccines %>% 
  as.data.frame %>%
  mutate_all(~ case_when(
    . == 1 ~ "Strongly disagree",
    . == 2 ~ "Somewhat disagree",
    . == 3 ~ "Neutral",
    . == 4 ~ "Somewhat agree",
    . == 5 ~ "Strongly agree"
  ))

for(i in 1:dim(data_vaccines2)[2]) {
  data_vaccines2[,i] <- factor(data_vaccines2[,i], levels = c("Strongly disagree","Somewhat disagree","Neutral","Somewhat agree","Strongly agree"))
}




data_vaccines3 <- data_vaccines2 %>% pivot_longer(cols = everything(),names_to = "question",values_to = "answers")

data_vaccines3$question <- as.factor(data_vaccines3$question)
data_vaccines3$answers <- as.factor(data_vaccines3$answers)


data_vaccines4 <- data_vaccines3 %>% group_by(question, answers) %>% summarise(n=n())

data_vaccines5 <- data_vaccines4 %>% pivot_wider(names_from = "answers",  values_from = "n")



question_text_vaccines <- matrix(nrow = length(data_vaccines5$question), ncol = 2, data = NA)
question_text_vaccines <- as.data.frame(question_text_vaccines)

colnames(question_text_vaccines) <- c("question","question_text")
  
question_text_vaccines$question <- data_vaccines5$question
# # question_text_reliability$question_text <- c("The health information I receive from my other healthcare provider is...","The health information I receive from my family & friends is...","The health information I receive from my social media is...","The health information I receive from traditional media (the news) is...","The health information I receive from a Google search is...","The health information I receive from the government is...","The health information I receive from my family physician is...","The health information I receive from my prenatal care provider is...")

question_text_vaccines$question_text <- c("New vaccines carry more risks than older vaccines","I am concerned about potential serious adverse effects of vaccines","COVID-19 is a serious illness","COVID-19 is a more serious illness for someone who is pregnant than someone who is not","COVID-19 vaccines are beneficial","COVID-19 vaccines are beneficial for pregnant/lactating women/people","COVID-19 vaccines have been adequately tested","COVID-19 vaccines have been adequately tested in pregnant/lactating women/people","COVID-19 vaccines are safe","COVID-19 vaccines are safe for pregnant/lactating women/people","COVID-19 vaccines are safe for the fetus/unborn baby","COVID-19 vaccines are effective in preventing COVID-19","COVID-19 vaccines are effective in preventing COVID-19 in pregnant/lactating women/people","Most people who are important to me would think that I should receive the COVID-19 vaccine while pregnant/lactating","I feel under social pressure to receive a COVID-19 vaccine while pregnant/lactating")

data_vaccines_forplot <- inner_join(data_vaccines4,question_text_vaccines, by = c("question"))

data_vaccines_forplot$answers

g3 = ggplot(data = data_vaccines_forplot[-which(is.na(data_vaccines_forplot$answers)),],aes(x = reorder(question_text,n), y=n, fill=answers, label = n))+
  geom_col(width = 0.5)+
   geom_text(size = 3, position = position_stack(vjust = 0.5), check_overlap =TRUE,colour = "white") +
  ggtitle("Figure 2: Theory of Planned Behavior - Attitudes towards COVID-19 Vaccines")+
  ylab("Number of Respondents")+
  coord_flip()+
  xlab("Question")+
  # scale_fill_brewer(palette="PRGn")+
  theme(legend.position="top", panel.background = element_blank(),legend.text = element_text(size = 10, colour = "black"), plot.title = element_text(size = 14, colour = "black"), legend.title = element_blank(), legend.key.size = unit(.25, "cm"), text = element_text(family = "Times New Roman"), axis.title.y = element_blank(),axis.text.y = element_text(size = 10,colour = "black",hjust = 1))+ 
  scale_x_discrete(labels = function(x) str_wrap(x, width = 60)) +
  scale_fill_manual("Legend", values = c("Strongly agree" = "#7eab56", "Somewhat agree" = "#f3c34a", "Neutral" = "#af2322","Somewhat disagree" = "#d58942","Strongly disagree" = "#6568b1"), breaks = c("Strongly agree", "Somewhat agree", "Neutral","Somewhat disagree","Strongly disagree"))
  #scale_x_discrete(limits=c("StronglyAgree", "Agree", "DontKnow","Disagree","StronglyDisagree"))
g3
# data_reliability2 <- data_reliability %>% pivot_longer(cols =)
ggsave("g3.jpeg", width = 14, height = 7)
```


```{r bar plots 2, include = TRUE}
data_vaccines <- data[,c("v20_beneficial_BL","v21_beneficial_preg_BL","v22_tested_BL","v23_tested_preg_BL","v24_safe_BL","v25_safe_preg_BL","v26_safe_fetus_BL","v27_effective_BL","v28_effective_preg_BL")]

data_vaccines2 <- data_vaccines %>% 
  as.data.frame %>%
  mutate_all(~ case_when(
    . == 1 ~ "Strongly disagree",
    . == 2 ~ "Somewhat disagree",
    . == 3 ~ "Neutral",
    . == 4 ~ "Somewhat agree",
    . == 5 ~ "Strongly agree"
  ))

for(i in 1:dim(data_vaccines2)[2]) {
  data_vaccines2[,i] <- factor(data_vaccines2[,i], levels = c("Strongly agree","Somewhat agree","Neutral","Somewhat disagree","Strongly disagree"))
}




data_vaccines3 <- data_vaccines2 %>% pivot_longer(cols = everything(),names_to = "question",values_to = "answers")

data_vaccines3$question <- as.factor(data_vaccines3$question)
data_vaccines3$answers <- as.factor(data_vaccines3$answers)


data_vaccines4 <- data_vaccines3 %>% group_by(question, answers) %>% summarise(n=n())

data_vaccines5 <- data_vaccines4 %>% pivot_wider(names_from = "answers",  values_from = "n")



question_text_vaccines <- matrix(nrow = length(data_vaccines5$question), ncol = 2, data = NA)
question_text_vaccines <- as.data.frame(question_text_vaccines)

colnames(question_text_vaccines) <- c("question","question_text")
  
question_text_vaccines$question <- data_vaccines5$question

question_text_vaccines$question_text <- c("COVID-19 vaccines are beneficial","COVID-19 vaccines are beneficial for pregnant/lactating women/people","COVID-19 vaccines have been adequately tested","COVID-19 vaccines have been adequately tested in pregnant/lactating women/people","COVID-19 vaccines are safe","COVID-19 vaccines are safe for pregnant/lactating women/people","COVID-19 vaccines are safe for the fetus/unborn baby","COVID-19 vaccines are effective in preventing COVID-19","COVID-19 vaccines are effective in preventing COVID-19 in pregnant/lactating women/people")

data_vaccines_forplot <- inner_join(data_vaccines4,question_text_vaccines, by = c("question"))

data_vaccines_forplot$question_text <- factor(data_vaccines_forplot$question_text , levels = c("COVID-19 vaccines are beneficial","COVID-19 vaccines are beneficial for pregnant/lactating women/people","COVID-19 vaccines have been adequately tested","COVID-19 vaccines have been adequately tested in pregnant/lactating women/people","COVID-19 vaccines are safe","COVID-19 vaccines are safe for pregnant/lactating women/people","COVID-19 vaccines are safe for the fetus/unborn baby","COVID-19 vaccines are effective in preventing COVID-19","COVID-19 vaccines are effective in preventing COVID-19 in pregnant/lactating women/people"))

data_vaccines_forplot$question_text <- fct_rev(data_vaccines_forplot$question_text)

g4 = ggplot(data = data_vaccines_forplot[-which(is.na(data_vaccines_forplot$answers)),],aes(x = question_text, y=n, fill=answers, label = n))+
  geom_col(width = 0.5)+
   geom_text(size = 3, position = position_stack(vjust = 0.5), check_overlap =TRUE,colour = "white") +
  ggtitle("Figure 2: Theory of Planned Behavior - Attitudes towards COVID-19 Vaccines")+
  ylab("Number of Respondents")+
  coord_flip()+
  xlab("Question")+
  # scale_fill_brewer(palette="PRGn")+
  theme(legend.position="top", panel.background = element_blank(),legend.text = element_text(size = 10, colour = "black"), plot.title = element_text(size = 14, colour = "black"), legend.title = element_blank(), legend.key.size = unit(.25, "cm"), text = element_text(family = "Times New Roman"), axis.title.y = element_blank(),axis.text.y = element_text(size = 10,colour = "black",hjust = 1))+ 
  scale_x_discrete(labels = function(x) str_wrap(x, width = 60)) +
  scale_fill_manual("Legend", values = c("Strongly disagree" = "#6568b1","Somewhat disagree" = "#d58942","Neutral" = "#af2322", "Somewhat agree" = "#f3c34a","Strongly agree" = "#7eab56" ), breaks = c("Strongly disagree","Somewhat disagree","Neutral","Somewhat agree","Strongly agree"))
g4
# data_reliability2 <- data_reliability %>% pivot_longer(cols =)
ggsave("g4.jpeg", width = 14, height = 7)
```



```{r bar plots 3, include = TRUE}
data_vaccines <- data[,c("v4_before_value_BL","v5_today_value_BL")]

data_vaccines2 <- data_vaccines %>% 
  as.data.frame %>%
  mutate_all(~ case_when(
    . == 1 ~ "No value",
    . == 2 ~ "Very little value",
    . == 3 ~ "Neutral",
    . == 4 ~ "A little value",
    . == 5 ~ "Valued a lot"
  ))

for(i in 1:dim(data_vaccines2)[2]) {
  data_vaccines2[,i] <- factor(data_vaccines2[,i], levels = c("Valued a lot","A little value","Neutral","Very little value","No value"))
}




data_vaccines3 <- data_vaccines2 %>% pivot_longer(cols = everything(),names_to = "question",values_to = "answers")

data_vaccines3$question <- as.factor(data_vaccines3$question)
data_vaccines3$answers <- as.factor(data_vaccines3$answers)


data_vaccines4 <- data_vaccines3 %>% group_by(question, answers) %>% summarise(n=n())

data_vaccines5 <- data_vaccines4 %>% pivot_wider(names_from = "answers",  values_from = "n")



question_text_vaccines <- matrix(nrow = length(data_vaccines5$question), ncol = 2, data = NA)
question_text_vaccines <- as.data.frame(question_text_vaccines)

colnames(question_text_vaccines) <- c("question","question_text")
  
question_text_vaccines$question <- data_vaccines5$question

question_text_vaccines$question_text <- c("Thinking back to before the beginning of the COVID-19 pandemic (December 2019), how much did you value vaccines?","Today, how much do you value vaccines?")

data_vaccines_forplot <- inner_join(data_vaccines4,question_text_vaccines, by = c("question"))

g5 = ggplot(data = data_vaccines_forplot[-which(is.na(data_vaccines_forplot$answers)),],aes(x = question_text, y=n, fill=answers, label = n))+
  geom_col(width = 0.5)+
   geom_text(size = 3, position = position_stack(vjust = 0.5), check_overlap =TRUE,colour = "white") +
  ggtitle("Figure 1: WHO Vaccine Hesitancy Scale - Perceived Vaccine Risks ")+
  ylab("Number of Respondents")+
  coord_flip()+
  xlab("Question")+
  # scale_fill_brewer(palette="PRGn")+
  theme(legend.position="top", panel.background = element_blank(),legend.text = element_text(size = 10, colour = "black"), plot.title = element_text(size = 14, colour = "black"), legend.title = element_blank(), legend.key.size = unit(.25, "cm"), text = element_text(family = "Times New Roman"), axis.title.y = element_blank(),axis.text.y = element_text(size = 12,colour = "black",hjust = 1))+ 
  scale_x_discrete(labels = function(x) str_wrap(x, width = 60)) +
  scale_fill_manual("Legend", values = c("No value" = "#6568b1","Very little value" = "#d58942","Neutral" = "#af2322", "A little value" = "#f3c34a","Valued a lot" = "#7eab56" ), breaks = c("No value","Very little value","Neutral","A little value","Valued a lot"))
g5
# data_reliability2 <- data_reliability %>% pivot_longer(cols =)
ggsave("g5.jpeg", width = 14, height = 7)
```



```{r bar plots 4, include = TRUE}
data_vaccines <- data[,c("v16_risks_BL","v17_effects_BL")]

data_vaccines2 <- data_vaccines %>% 
  as.data.frame %>%
  mutate_all(~ case_when(
    . == 1 ~ "Strongly disagree",
    . == 2 ~ "Somewhat disagree",
    . == 3 ~ "Neutral",
    . == 4 ~ "Somewhat agree",
    . == 5 ~ "Strongly agree"
  ))

for(i in 1:dim(data_vaccines2)[2]) {
  data_vaccines2[,i] <- factor(data_vaccines2[,i], levels = c("Strongly agree","Somewhat agree","Neutral","Somewhat disagree","Strongly disagree"))
}




data_vaccines3 <- data_vaccines2 %>% pivot_longer(cols = everything(),names_to = "question",values_to = "answers")

data_vaccines3$question <- as.factor(data_vaccines3$question)
data_vaccines3$answers <- as.factor(data_vaccines3$answers)


data_vaccines4 <- data_vaccines3 %>% group_by(question, answers) %>% summarise(n=n())

data_vaccines5 <- data_vaccines4 %>% pivot_wider(names_from = "answers",  values_from = "n")



question_text_vaccines <- matrix(nrow = length(data_vaccines5$question), ncol = 2, data = NA)
question_text_vaccines <- as.data.frame(question_text_vaccines)

colnames(question_text_vaccines) <- c("question","question_text")
  
question_text_vaccines$question <- data_vaccines5$question

question_text_vaccines$question_text <- c("New vaccines carry more risks than older vaccines","I am concerned about potential serious adverse effects of vaccines")

data_vaccines_forplot <- inner_join(data_vaccines4,question_text_vaccines, by = c("question"))

g5 = ggplot(data = data_vaccines_forplot[-which(is.na(data_vaccines_forplot$answers)),],aes(x = question_text, y=n, fill=answers, label = n))+
  geom_col(width = 0.5)+
   geom_text(size = 3, position = position_stack(vjust = 0.5), check_overlap =TRUE,colour = "white") +
  ggtitle("Figure 1: WHO Vaccine Hesitancy Scale - Perceived Vaccine Risks")+
  ylab("Number of Respondents")+
  coord_flip()+
  xlab("Question")+
  # scale_fill_brewer(palette="PRGn")+
  theme(legend.position="top", panel.background = element_blank(),legend.text = element_text(size = 10, colour = "black"), plot.title = element_text(size = 14, colour = "black"), legend.title = element_blank(), legend.key.size = unit(.25, "cm"), text = element_text(family = "Times New Roman"), axis.title.y = element_blank(),axis.text.y = element_text(size = 12,colour = "black",hjust = 1))+ 
  scale_x_discrete(labels = function(x) str_wrap(x, width = 60)) +
  scale_fill_manual("Legend", values = c("Strongly disagree" = "#6568b1","Somewhat disagree" = "#d58942","Neutral" = "#af2322", "Somewhat agree" = "#f3c34a","Strongly agree" = "#7eab56" ), breaks = c("Strongly disagree","Somewhat disagree","Neutral","Somewhat agree","Strongly agree"))
g5
# data_reliability2 <- data_reliability %>% pivot_longer(cols =)
ggsave("g6.jpeg", width = 14, height = 7)
```
<br>


I ran logistic regressions of all of the singificant bivariable relationships and included all into a multivariable model. For education, post-hoc pairwise Tukey's tests confirm that the only pairwise significant difference was between graduate degree and bachelor's degree (adjusted p = 0.025), likely due to smaller sample size in the other education categories.




```{r regression tables, include = TRUE}

tab_model(mod1)

tab_model(mod2)

tab_model(mod3)

tab_model(mod4)

tab_model(mod5)

tab_model(mod6)

tab_model(mod7)

tab_model(mod8)

tab_model(mod9)

tab_model(mod10)

tab_model(mod11)

tab_model(mod12)

tab_model(mod13)

tab_model(mod14)

tab_model(mod15)

tab_model(mod16)

tab_model(mod17)

tab_model(mod18)

tab_model(mod19)

tab_model(mod20)

tab_model(mod21)

tab_model(mod22)

tab_model(mod23)

tab_model(mod24)

tab_model(mod_all)

tab_model(mod_all_IF)

```